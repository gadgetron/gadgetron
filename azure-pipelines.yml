variables:
  AzureConnection: 'BiomedicalImaging-NonProd(87d8acb3-5176-4651-b457-6ab9cefd8e3d)'
  imageBaseName: 'ghcr.io/gadgetron/gadgetron/gadgetron_ubuntu'
  DOCKER_BUILDKIT: 1
  isPR: $[eq(variables['Build.Reason'], 'PullRequest')]
  isCI: $[or(eq(variables['Build.Reason'], 'IndividualCI'), eq(variables['Build.Reason'], 'BatchedCI'))]


# Trigger when merging to master
trigger:
- master

# Trigger for PRs that merge to master
pr:
- master

jobs:
- job: buildAndTestMacOS
  pool:
    name: Azure Pipelines
    vmImage: macOS-latest
  timeoutInMinutes: 360
  displayName: "Building on macOS (not testing yet)"
  steps:
  - task: AzureKeyVault@2
    inputs:
      azureSubscription: $(AzureConnection)
      keyVaultName: gadgetron-build-secrets
  - script: |
      eval "$(conda shell.bash hook)"
      uname -a
      which conda
      # conda install -c conda-forge conda-build
      # conda env create -f environment-macos.yml
      # conda activate gadgetron
      # set -euo pipefail
      # cd conda && ./package.sh
    displayName: "Building Gadgetron on macOS"
